<!doctype html>
<html class="default no-js">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Repository | identity</title>
	<meta name="description" content="">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="../assets/css/main.css">
</head>
<body>
<header>
	<div class="tsd-page-toolbar">
		<div class="container">
			<div class="table-wrap">
				<div class="table-cell" id="tsd-search" data-index="../assets/js/search.js" data-base="..">
					<div class="field">
						<label for="tsd-search-field" class="tsd-widget search no-caption">Search</label>
						<input id="tsd-search-field" type="text" />
					</div>
					<ul class="results">
						<li class="state loading">Preparing search index...</li>
						<li class="state failure">The search index is not available</li>
					</ul>
					<a href="../index.html" class="title">identity</a>
				</div>
				<div class="table-cell" id="tsd-widgets">
					<div id="tsd-filter">
						<a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a>
						<div class="tsd-filter-group">
							<div class="tsd-select" id="tsd-filter-visibility">
								<span class="tsd-select-label">All</span>
								<ul class="tsd-select-list">
									<li data-value="public">Public</li>
									<li data-value="protected">Public/Protected</li>
									<li data-value="private" class="selected">All</li>
								</ul>
							</div>
							<input type="checkbox" id="tsd-filter-inherited" checked />
							<label class="tsd-widget" for="tsd-filter-inherited">Inherited</label>
							<input type="checkbox" id="tsd-filter-externals" checked />
							<label class="tsd-widget" for="tsd-filter-externals">Externals</label>
							<input type="checkbox" id="tsd-filter-only-exported" />
							<label class="tsd-widget" for="tsd-filter-only-exported">Only exported</label>
						</div>
					</div>
					<a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a>
				</div>
			</div>
		</div>
	</div>
	<div class="tsd-page-title">
		<div class="container">
			<ul class="tsd-breadcrumb">
				<li>
					<a href="../globals.html">Globals</a>
				</li>
				<li>
					<a href="../modules/_repository_.html">&quot;repository&quot;</a>
				</li>
				<li>
					<a href="_repository_.repository.html">Repository</a>
				</li>
			</ul>
			<h1>Class Repository</h1>
		</div>
	</div>
</header>
<div class="container container-main">
	<div class="row">
		<div class="col-8 col-content">
			<section class="tsd-panel tsd-comment">
				<div class="tsd-comment tsd-typography">
					<div class="lead">
						<p>The final arbiter of business logic and the handler of interactions with the storage engine.</p>
					</div>
					<dl class="tsd-comment-tags">
						<dt>note</dt>
						<dd><p>Each method represents an action which can be done on the entities the identity service
								operates with. Conversely, no other action can be done on these entities that is not
							provided by this class.</p>
						</dd>
						<dt>note</dt>
						<dd><p>The storage engine is PostgreSQL at the moment. Each entity (session and user) has a
								corresponding table. Each also has a corresponding events table. Whenever a mutation
								occurs, the fact is recorded in the events table along side the data of the mutation.
								Ideally, one would be able to reconstruct the current state in the entity table, by
							applying the mutations described in the events table in order.</p>
						</dd>
					</dl>
				</div>
			</section>
			<section class="tsd-panel tsd-hierarchy">
				<h3>Hierarchy</h3>
				<ul class="tsd-hierarchy">
					<li>
						<span class="target">Repository</span>
					</li>
				</ul>
			</section>
			<section class="tsd-panel-group tsd-index-group">
				<h2>Index</h2>
				<section class="tsd-panel tsd-index-panel">
					<div class="tsd-index-content">
						<section class="tsd-index-section ">
							<h3>Constructors</h3>
							<ul class="tsd-index-list">
								<li class="tsd-kind-constructor tsd-parent-kind-class"><a href="_repository_.repository.html#constructor" class="tsd-kind-icon">constructor</a></li>
							</ul>
						</section>
						<section class="tsd-index-section ">
							<h3>Properties</h3>
							<ul class="tsd-index-list">
								<li class="tsd-kind-property tsd-parent-kind-class tsd-is-static"><a href="_repository_.repository.html#max_number_of_users_to_return" class="tsd-kind-icon">MAX_<wbr>NUMBER_<wbr>OF_<wbr>USERS_<wbr>TO_<wbr>RETURN</a></li>
							</ul>
						</section>
						<section class="tsd-index-section ">
							<h3>Methods</h3>
							<ul class="tsd-index-list">
								<li class="tsd-kind-method tsd-parent-kind-class"><a href="_repository_.repository.html#_dbusertopublicuser" class="tsd-kind-icon">_db<wbr>User<wbr>ToPublic<wbr>User</a></li>
								<li class="tsd-kind-method tsd-parent-kind-class"><a href="_repository_.repository.html#agreetocookiepolicyforsession" class="tsd-kind-icon">agree<wbr>ToCookie<wbr>Policy<wbr>For<wbr>Session</a></li>
								<li class="tsd-kind-method tsd-parent-kind-class"><a href="_repository_.repository.html#getorcreatesession" class="tsd-kind-icon">get<wbr>OrCreate<wbr>Session</a></li>
								<li class="tsd-kind-method tsd-parent-kind-class"><a href="_repository_.repository.html#getorcreateuseronsession" class="tsd-kind-icon">get<wbr>OrCreate<wbr>User<wbr>OnSession</a></li>
								<li class="tsd-kind-method tsd-parent-kind-class"><a href="_repository_.repository.html#getsession" class="tsd-kind-icon">get<wbr>Session</a></li>
								<li class="tsd-kind-method tsd-parent-kind-class"><a href="_repository_.repository.html#getuseronsession" class="tsd-kind-icon">get<wbr>User<wbr>OnSession</a></li>
								<li class="tsd-kind-method tsd-parent-kind-class"><a href="_repository_.repository.html#getusersinfo" class="tsd-kind-icon">get<wbr>Users<wbr>Info</a></li>
								<li class="tsd-kind-method tsd-parent-kind-class"><a href="_repository_.repository.html#init" class="tsd-kind-icon">init</a></li>
								<li class="tsd-kind-method tsd-parent-kind-class"><a href="_repository_.repository.html#removesession" class="tsd-kind-icon">remove<wbr>Session</a></li>
								<li class="tsd-kind-method tsd-parent-kind-class tsd-is-static"><a href="_repository_.repository.html#_dbsessiontosession" class="tsd-kind-icon">_db<wbr>Session<wbr>ToSession</a></li>
							</ul>
						</section>
					</div>
				</section>
			</section>
			<section class="tsd-panel-group tsd-member-group ">
				<h2>Constructors</h2>
				<section class="tsd-panel tsd-member tsd-kind-constructor tsd-parent-kind-class">
					<a name="constructor" class="tsd-anchor"></a>
					<h3>constructor</h3>
					<ul class="tsd-signatures tsd-kind-constructor tsd-parent-kind-class">
						<li class="tsd-signature tsd-kind-icon">new <wbr>Repository<span class="tsd-signature-symbol">(</span>conn<span class="tsd-signature-symbol">: </span><span class="tsd-signature-type">knex</span><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol">: </span><a href="_repository_.repository.html" class="tsd-signature-type">Repository</a></li>
					</ul>
					<ul class="tsd-descriptions">
						<li class="tsd-description">
							<aside class="tsd-sources">
								<ul>
									<li>Defined in repository.ts:104</li>
								</ul>
							</aside>
							<div class="tsd-comment tsd-typography">
								<div class="lead">
									<p>Construct a repository.</p>
								</div>
							</div>
							<h4 class="tsd-parameters-title">Parameters</h4>
							<ul class="tsd-parameters">
								<li>
									<h5>conn: <span class="tsd-signature-type">knex</span></h5>
									<div class="tsd-comment tsd-typography">
										<div class="lead">
											<p>An open connection to the database.</p>
										</div>
									</div>
								</li>
							</ul>
							<h4 class="tsd-returns-title">Returns <a href="_repository_.repository.html" class="tsd-signature-type">Repository</a></h4>
						</li>
					</ul>
				</section>
			</section>
			<section class="tsd-panel-group tsd-member-group ">
				<h2>Properties</h2>
				<section class="tsd-panel tsd-member tsd-kind-property tsd-parent-kind-class tsd-is-static">
					<a name="max_number_of_users_to_return" class="tsd-anchor"></a>
					<h3><span class="tsd-flag ts-flagStatic">Static</span> MAX_<wbr>NUMBER_<wbr>OF_<wbr>USERS_<wbr>TO_<wbr>RETURN</h3>
					<div class="tsd-signature tsd-kind-icon">MAX_<wbr>NUMBER_<wbr>OF_<wbr>USERS_<wbr>TO_<wbr>RETURN<span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">number</span><span class="tsd-signature-symbol"> =&nbsp;20</span></div>
					<aside class="tsd-sources">
						<ul>
							<li>Defined in repository.ts:77</li>
						</ul>
					</aside>
					<div class="tsd-comment tsd-typography">
						<div class="lead">
							<p>The maximum number of users <a href="_repository_.repository.html#getusersinfo">Repository.getUsersInfo</a> is allowed to return.</p>
						</div>
					</div>
				</section>
			</section>
			<section class="tsd-panel-group tsd-member-group ">
				<h2>Methods</h2>
				<section class="tsd-panel tsd-member tsd-kind-method tsd-parent-kind-class">
					<a name="_dbusertopublicuser" class="tsd-anchor"></a>
					<h3>_db<wbr>User<wbr>ToPublic<wbr>User</h3>
					<ul class="tsd-signatures tsd-kind-method tsd-parent-kind-class">
						<li class="tsd-signature tsd-kind-icon">_db<wbr>User<wbr>ToPublic<wbr>User<span class="tsd-signature-symbol">(</span>dbUser<span class="tsd-signature-symbol">: </span><span class="tsd-signature-type">any</span><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol">: </span><span class="tsd-signature-type">PublicUser</span></li>
					</ul>
					<ul class="tsd-descriptions">
						<li class="tsd-description">
							<aside class="tsd-sources">
								<ul>
									<li>Defined in repository.ts:592</li>
								</ul>
							</aside>
							<h4 class="tsd-parameters-title">Parameters</h4>
							<ul class="tsd-parameters">
								<li>
									<h5>dbUser: <span class="tsd-signature-type">any</span></h5>
								</li>
							</ul>
							<h4 class="tsd-returns-title">Returns <span class="tsd-signature-type">PublicUser</span></h4>
						</li>
					</ul>
				</section>
				<section class="tsd-panel tsd-member tsd-kind-method tsd-parent-kind-class">
					<a name="agreetocookiepolicyforsession" class="tsd-anchor"></a>
					<h3>agree<wbr>ToCookie<wbr>Policy<wbr>For<wbr>Session</h3>
					<ul class="tsd-signatures tsd-kind-method tsd-parent-kind-class">
						<li class="tsd-signature tsd-kind-icon">agree<wbr>ToCookie<wbr>Policy<wbr>For<wbr>Session<span class="tsd-signature-symbol">(</span>sessionToken<span class="tsd-signature-symbol">: </span><span class="tsd-signature-type">SessionToken</span>, requestTime<span class="tsd-signature-symbol">: </span><span class="tsd-signature-type">Date</span>, xsrfToken<span class="tsd-signature-symbol">: </span><span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol">: </span><span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">Session</span><span class="tsd-signature-symbol">&gt;</span></li>
					</ul>
					<ul class="tsd-descriptions">
						<li class="tsd-description">
							<aside class="tsd-sources">
								<ul>
									<li>Defined in repository.ts:282</li>
								</ul>
							</aside>
							<div class="tsd-comment tsd-typography">
								<div class="lead">
									<p>Agree to the cookie policy for the session identified by {@link SessionToken}. If the user is
									also logged in (there exists an attached {@link User}), that is also marked as such.</p>
								</div>
								<dl class="tsd-comment-tags">
									<dt>note</dt>
									<dd><p>Events are generated for both the session and user entities.</p>
									</dd>
									<dt>note</dt>
									<dd><p>This is a mutation, and as such an xsrfToken needs to be provided and match the one
										attached to the session.</p>
									</dd>
									<dt>note</dt>
									<dd><p>This operation is idempotent.</p>
									</dd>
									<dt>throws</dt>
									<dd><p>If the session token doesn&#39;t identify an existing active session, this will raise
										a <a href="_repository_.sessionnotfounderror.html">SessionNotFoundError</a>.</p>
									</dd>
									<dt>throws</dt>
									<dd><p>If the session&#39;s XSRF token and the provided one don&#39;t match, this will raise
										a <a href="_repository_.xsrftokenmismatcherror.html">XsrfTokenMismatchError</a>.</p>
									</dd>
								</dl>
							</div>
							<h4 class="tsd-parameters-title">Parameters</h4>
							<ul class="tsd-parameters">
								<li>
									<h5>sessionToken: <span class="tsd-signature-type">SessionToken</span></h5>
									<div class="tsd-comment tsd-typography">
										<p>the session token to try to remove.</p>
									</div>
								</li>
								<li>
									<h5>requestTime: <span class="tsd-signature-type">Date</span></h5>
									<div class="tsd-comment tsd-typography">
										<p>the time at which the request was issued to the identity service. Used
										populate various &quot;modified_at&quot; fields.</p>
									</div>
								</li>
								<li>
									<h5>xsrfToken: <span class="tsd-signature-type">string</span></h5>
									<div class="tsd-comment tsd-typography">
										<p>the xsrfToken which guards this mutation from being issues via XSRF
										attacks.</p>
									</div>
								</li>
							</ul>
							<h4 class="tsd-returns-title">Returns <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">Session</span><span class="tsd-signature-symbol">&gt;</span></h4>
						</li>
					</ul>
				</section>
				<section class="tsd-panel tsd-member tsd-kind-method tsd-parent-kind-class">
					<a name="getorcreatesession" class="tsd-anchor"></a>
					<h3>get<wbr>OrCreate<wbr>Session</h3>
					<ul class="tsd-signatures tsd-kind-method tsd-parent-kind-class">
						<li class="tsd-signature tsd-kind-icon">get<wbr>OrCreate<wbr>Session<span class="tsd-signature-symbol">(</span>sessionToken<span class="tsd-signature-symbol">: </span><span class="tsd-signature-type">SessionToken</span><span class="tsd-signature-symbol"> | </span><span class="tsd-signature-type">null</span>, requestTime<span class="tsd-signature-symbol">: </span><span class="tsd-signature-type">Date</span><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol">: </span><span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-symbol">[</span><span class="tsd-signature-type">SessionToken</span><span class="tsd-signature-symbol">, </span><span class="tsd-signature-type">Session</span><span class="tsd-signature-symbol">, </span><span class="tsd-signature-type">boolean</span><span class="tsd-signature-symbol">]</span><span class="tsd-signature-symbol">&gt;</span></li>
					</ul>
					<ul class="tsd-descriptions">
						<li class="tsd-description">
							<aside class="tsd-sources">
								<ul>
									<li>Defined in repository.ts:135</li>
								</ul>
							</aside>
							<div class="tsd-comment tsd-typography">
								<div class="lead">
									<p>Retrieve the session associated with the provided {@link SessionToken}, or create a new one
										if there&#39;s no token. If the token is null or if it doesn&#39;t exist, a new session is created.
									This means allocating a token and creating a session for it.</p>
								</div>
								<dl class="tsd-comment-tags">
									<dt>note</dt>
									<dd><p>The operation is idempotent wrt sessionToken. Calling this multiple times with the same
										sessionToken (or with the same sessionId more precisely) will just retrieve the initial one.</p>
									</dd>
								</dl>
							</div>
							<h4 class="tsd-parameters-title">Parameters</h4>
							<ul class="tsd-parameters">
								<li>
									<h5>sessionToken: <span class="tsd-signature-type">SessionToken</span><span class="tsd-signature-symbol"> | </span><span class="tsd-signature-type">null</span></h5>
									<div class="tsd-comment tsd-typography">
										<p>the session token to try to retrieve. Can be null, in which case a
										new session will be created.</p>
									</div>
								</li>
								<li>
									<h5>requestTime: <span class="tsd-signature-type">Date</span></h5>
									<div class="tsd-comment tsd-typography">
										<p>the time at which the request was issued to the identity service. Used
										populate various &quot;modified_at&quot; fields.</p>
									</div>
								</li>
							</ul>
							<h4 class="tsd-returns-title">Returns <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-symbol">[</span><span class="tsd-signature-type">SessionToken</span><span class="tsd-signature-symbol">, </span><span class="tsd-signature-type">Session</span><span class="tsd-signature-symbol">, </span><span class="tsd-signature-type">boolean</span><span class="tsd-signature-symbol">]</span><span class="tsd-signature-symbol">&gt;</span></h4>
							<p>a tuple of {@link SessionToken}, {@link Session} and a boolean indicating whether
							a new session was created or not.</p>
						</li>
					</ul>
				</section>
				<section class="tsd-panel tsd-member tsd-kind-method tsd-parent-kind-class">
					<a name="getorcreateuseronsession" class="tsd-anchor"></a>
					<h3>get<wbr>OrCreate<wbr>User<wbr>OnSession</h3>
					<ul class="tsd-signatures tsd-kind-method tsd-parent-kind-class">
						<li class="tsd-signature tsd-kind-icon">get<wbr>OrCreate<wbr>User<wbr>OnSession<span class="tsd-signature-symbol">(</span>sessionToken<span class="tsd-signature-symbol">: </span><span class="tsd-signature-type">SessionToken</span>, auth0Profile<span class="tsd-signature-symbol">: </span><a href="_auth0_profile_.auth0profile.html" class="tsd-signature-type">Auth0Profile</a>, requestTime<span class="tsd-signature-symbol">: </span><span class="tsd-signature-type">Date</span>, xsrfToken<span class="tsd-signature-symbol">: </span><span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol">: </span><span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-symbol">[</span><span class="tsd-signature-type">SessionToken</span><span class="tsd-signature-symbol">, </span><span class="tsd-signature-type">Session</span><span class="tsd-signature-symbol">, </span><span class="tsd-signature-type">boolean</span><span class="tsd-signature-symbol">]</span><span class="tsd-signature-symbol">&gt;</span></li>
					</ul>
					<ul class="tsd-descriptions">
						<li class="tsd-description">
							<aside class="tsd-sources">
								<ul>
									<li>Defined in repository.ts:368</li>
								</ul>
							</aside>
							<div class="tsd-comment tsd-typography">
								<div class="lead">
									<p>Retrieve the session and the corresponding user associated with the provided
										{@link SessionToken} and <a href="_auth0_profile_.auth0profile.html">Auth0Profile</a>, or create a new one if there&#39;s no token
									or user. To be more precise, the session must exist, it&#39;s just the user which is optional.</p>
								</div>
								<dl class="tsd-comment-tags">
									<dt>note</dt>
									<dd><p>The operation is idempotent wrt sessionToken and auth0Profile. Calling this multiple
											times with the same sessionToken and auth0Profile (or sessionId and userToken more
										precisely) will just retrieve the initial ones.</p>
									</dd>
									<dt>note</dt>
									<dd><p>This is a mutation, and as such an xsrfToken needs to be provided and match the one
										attached to the session.</p>
									</dd>
									<dt>throws</dt>
									<dd><p>If the session token doesn&#39;t identify an existing active session, this will raise
										a <a href="_repository_.sessionnotfounderror.html">SessionNotFoundError</a>.</p>
									</dd>
									<dt>throws</dt>
									<dd><p>If the session exists, but is attached to another user, this will raise
										a <a href="_repository_.sessionnotfounderror.html">SessionNotFoundError</a>.</p>
									</dd>
									<dt>throws</dt>
									<dd><p>If the session&#39;s XSRF token and the provided one don&#39;t match, this will raise
										a <a href="_repository_.xsrftokenmismatcherror.html">XsrfTokenMismatchError</a>.</p>
									</dd>
								</dl>
							</div>
							<h4 class="tsd-parameters-title">Parameters</h4>
							<ul class="tsd-parameters">
								<li>
									<h5>sessionToken: <span class="tsd-signature-type">SessionToken</span></h5>
									<div class="tsd-comment tsd-typography">
										<p>the session for which the user will be created.</p>
									</div>
								</li>
								<li>
									<h5>auth0Profile: <a href="_auth0_profile_.auth0profile.html" class="tsd-signature-type">Auth0Profile</a></h5>
									<div class="tsd-comment tsd-typography">
										<p>information from Auth0 about the user.</p>
									</div>
								</li>
								<li>
									<h5>requestTime: <span class="tsd-signature-type">Date</span></h5>
									<div class="tsd-comment tsd-typography">
										<p>the time at which the request was issued to the identity service. Used
										populate various &quot;modified_at&quot; fields.</p>
									</div>
								</li>
								<li>
									<h5>xsrfToken: <span class="tsd-signature-type">string</span></h5>
									<div class="tsd-comment tsd-typography">
										<p>the xsrfToken which guards this mutation from being issues via XSRF
										attacks.</p>
									</div>
								</li>
							</ul>
							<h4 class="tsd-returns-title">Returns <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-symbol">[</span><span class="tsd-signature-type">SessionToken</span><span class="tsd-signature-symbol">, </span><span class="tsd-signature-type">Session</span><span class="tsd-signature-symbol">, </span><span class="tsd-signature-type">boolean</span><span class="tsd-signature-symbol">]</span><span class="tsd-signature-symbol">&gt;</span></h4>
							<p>a tuple of {@link SessionToken}, {@link Session} and a boolean indicating whether
							a new user was created or not.</p>
						</li>
					</ul>
				</section>
				<section class="tsd-panel tsd-member tsd-kind-method tsd-parent-kind-class">
					<a name="getsession" class="tsd-anchor"></a>
					<h3>get<wbr>Session</h3>
					<ul class="tsd-signatures tsd-kind-method tsd-parent-kind-class">
						<li class="tsd-signature tsd-kind-icon">get<wbr>Session<span class="tsd-signature-symbol">(</span>sessionToken<span class="tsd-signature-symbol">: </span><span class="tsd-signature-type">SessionToken</span><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol">: </span><span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">Session</span><span class="tsd-signature-symbol">&gt;</span></li>
					</ul>
					<ul class="tsd-descriptions">
						<li class="tsd-description">
							<aside class="tsd-sources">
								<ul>
									<li>Defined in repository.ts:199</li>
								</ul>
							</aside>
							<div class="tsd-comment tsd-typography">
								<div class="lead">
									<p>Retrieve the session associated with the provided {@link SessionToken}.</p>
								</div>
								<dl class="tsd-comment-tags">
									<dt>throws</dt>
									<dd><p>If the session token doesn&#39;t identify an existing active session, this will raise
										a <a href="_repository_.sessionnotfounderror.html">SessionNotFoundError</a>.</p>
									</dd>
								</dl>
							</div>
							<h4 class="tsd-parameters-title">Parameters</h4>
							<ul class="tsd-parameters">
								<li>
									<h5>sessionToken: <span class="tsd-signature-type">SessionToken</span></h5>
									<div class="tsd-comment tsd-typography">
										<p>the session token to try to retrieve.</p>
									</div>
								</li>
							</ul>
							<h4 class="tsd-returns-title">Returns <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">Session</span><span class="tsd-signature-symbol">&gt;</span></h4>
							<p>A {@link Session} object describing the session.</p>
						</li>
					</ul>
				</section>
				<section class="tsd-panel tsd-member tsd-kind-method tsd-parent-kind-class">
					<a name="getuseronsession" class="tsd-anchor"></a>
					<h3>get<wbr>User<wbr>OnSession</h3>
					<ul class="tsd-signatures tsd-kind-method tsd-parent-kind-class">
						<li class="tsd-signature tsd-kind-icon">get<wbr>User<wbr>OnSession<span class="tsd-signature-symbol">(</span>sessionToken<span class="tsd-signature-symbol">: </span><span class="tsd-signature-type">SessionToken</span>, auth0Profile<span class="tsd-signature-symbol">: </span><a href="_auth0_profile_.auth0profile.html" class="tsd-signature-type">Auth0Profile</a><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol">: </span><span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">Session</span><span class="tsd-signature-symbol">&gt;</span></li>
					</ul>
					<ul class="tsd-descriptions">
						<li class="tsd-description">
							<aside class="tsd-sources">
								<ul>
									<li>Defined in repository.ts:496</li>
								</ul>
							</aside>
							<div class="tsd-comment tsd-typography">
								<div class="lead">
									<p>Retrieve the session and user associated with the provided {@link SessionToken} and
									<a href="_auth0_profile_.auth0profile.html">Auth0Profile</a></p>
								</div>
								<dl class="tsd-comment-tags">
									<dt>throws</dt>
									<dd><p>If the session token doesn&#39;t identify an existing active session, this will raise
										a <a href="_repository_.sessionnotfounderror.html">SessionNotFoundError</a>.</p>
									</dd>
									<dt>throws</dt>
									<dd><p>If the session exists, but is attached to another user, this will raise
										a <a href="_repository_.sessionnotfounderror.html">SessionNotFoundError</a>.</p>
									</dd>
									<dt>throws</dt>
									<dd><p>If the Auth0 profile information doesn&#39;t identify an existing active user, this will
										raise a <a href="_repository_.usernotfounderror.html">UserNotFoundError</a>.</p>
									</dd>
								</dl>
							</div>
							<h4 class="tsd-parameters-title">Parameters</h4>
							<ul class="tsd-parameters">
								<li>
									<h5>sessionToken: <span class="tsd-signature-type">SessionToken</span></h5>
									<div class="tsd-comment tsd-typography">
										<p>the session token to try to retrieve.</p>
									</div>
								</li>
								<li>
									<h5>auth0Profile: <a href="_auth0_profile_.auth0profile.html" class="tsd-signature-type">Auth0Profile</a></h5>
									<div class="tsd-comment tsd-typography">
										<p>the Auth0 profile of the user.</p>
									</div>
								</li>
							</ul>
							<h4 class="tsd-returns-title">Returns <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">Session</span><span class="tsd-signature-symbol">&gt;</span></h4>
							<p>A {@link Session} object describing the session and user.</p>
						</li>
					</ul>
				</section>
				<section class="tsd-panel tsd-member tsd-kind-method tsd-parent-kind-class">
					<a name="getusersinfo" class="tsd-anchor"></a>
					<h3>get<wbr>Users<wbr>Info</h3>
					<ul class="tsd-signatures tsd-kind-method tsd-parent-kind-class">
						<li class="tsd-signature tsd-kind-icon">get<wbr>Users<wbr>Info<span class="tsd-signature-symbol">(</span>ids<span class="tsd-signature-symbol">: </span><span class="tsd-signature-type">number</span><span class="tsd-signature-symbol">[]</span><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol">: </span><span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">PublicUser</span><span class="tsd-signature-symbol">[]</span><span class="tsd-signature-symbol">&gt;</span></li>
					</ul>
					<ul class="tsd-descriptions">
						<li class="tsd-description">
							<aside class="tsd-sources">
								<ul>
									<li>Defined in repository.ts:542</li>
								</ul>
							</aside>
							<div class="tsd-comment tsd-typography">
								<div class="lead">
									<p>Retrieve a set of users. Only a safe public view of the user is provided, as this
									is meant to be called on behalf of one user to find information about other users.</p>
								</div>
								<dl class="tsd-comment-tags">
									<dt>note</dt>
									<dd><p>At most <a href="_repository_.repository.html#max_number_of_users_to_return">Repository.MAX_NUMBER_OF_USERS_TO_RETURN</a> values will be provided.</p>
									</dd>
									<dt>todo</dt>
									<dd><p>Some pagination will be required here.</p>
									</dd>
									<dt>throws</dt>
									<dd><p>If there&#39;s no ids to retrieve or if there are too many, then this will raise
										a <a href="_repository_.repositoryerror.html">RepositoryError</a>.</p>
									</dd>
									<dt>throws</dt>
									<dd><p>If one of the requested users can&#39;t be retrieved, either because it doesn&#39;t exist
										or is inactive, this will throw <a href="_repository_.usernotfounderror.html">UserNotFoundError</a>.</p>
									</dd>
								</dl>
							</div>
							<h4 class="tsd-parameters-title">Parameters</h4>
							<ul class="tsd-parameters">
								<li>
									<h5>ids: <span class="tsd-signature-type">number</span><span class="tsd-signature-symbol">[]</span></h5>
									<div class="tsd-comment tsd-typography">
										<p>an array of ids of users to return.</p>
									</div>
								</li>
							</ul>
							<h4 class="tsd-returns-title">Returns <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">PublicUser</span><span class="tsd-signature-symbol">[]</span><span class="tsd-signature-symbol">&gt;</span></h4>
							<p>A list of user information.</p>
						</li>
					</ul>
				</section>
				<section class="tsd-panel tsd-member tsd-kind-method tsd-parent-kind-class">
					<a name="init" class="tsd-anchor"></a>
					<h3>init</h3>
					<ul class="tsd-signatures tsd-kind-method tsd-parent-kind-class">
						<li class="tsd-signature tsd-kind-icon">init<span class="tsd-signature-symbol">(</span><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol">: </span><span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">void</span><span class="tsd-signature-symbol">&gt;</span></li>
					</ul>
					<ul class="tsd-descriptions">
						<li class="tsd-description">
							<aside class="tsd-sources">
								<ul>
									<li>Defined in repository.ts:117</li>
								</ul>
							</aside>
							<div class="tsd-comment tsd-typography">
								<div class="lead">
									<p>Perform any initialization work on the repository before it can begin serving.</p>
								</div>
							</div>
							<h4 class="tsd-returns-title">Returns <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">void</span><span class="tsd-signature-symbol">&gt;</span></h4>
						</li>
					</ul>
				</section>
				<section class="tsd-panel tsd-member tsd-kind-method tsd-parent-kind-class">
					<a name="removesession" class="tsd-anchor"></a>
					<h3>remove<wbr>Session</h3>
					<ul class="tsd-signatures tsd-kind-method tsd-parent-kind-class">
						<li class="tsd-signature tsd-kind-icon">remove<wbr>Session<span class="tsd-signature-symbol">(</span>sessionToken<span class="tsd-signature-symbol">: </span><span class="tsd-signature-type">SessionToken</span>, requestTime<span class="tsd-signature-symbol">: </span><span class="tsd-signature-type">Date</span>, xsrfToken<span class="tsd-signature-symbol">: </span><span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol">: </span><span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">void</span><span class="tsd-signature-symbol">&gt;</span></li>
					</ul>
					<ul class="tsd-descriptions">
						<li class="tsd-description">
							<aside class="tsd-sources">
								<ul>
									<li>Defined in repository.ts:231</li>
								</ul>
							</aside>
							<div class="tsd-comment tsd-typography">
								<div class="lead">
									<p>Remove the session identified by the provided {@link SessionToken}.</p>
								</div>
								<dl class="tsd-comment-tags">
									<dt>note</dt>
									<dd><p>This simply marks the session as being in the {@link SessionState.Removed} state,
										and adds the appropriate event for the session, but doesn&#39;t physically remove anything.</p>
									</dd>
									<dt>note</dt>
									<dd><p>This is a mutation, and as such an xsrfToken needs to be provided and match the one
										attached to the session.</p>
									</dd>
									<dt>throws</dt>
									<dd><p>If the session token doesn&#39;t identify an existing active session, this will raise
										a <a href="_repository_.sessionnotfounderror.html">SessionNotFoundError</a>.</p>
									</dd>
									<dt>throws</dt>
									<dd><p>If the session&#39;s XSRF token and the provided one don&#39;t match, this will raise
										a <a href="_repository_.xsrftokenmismatcherror.html">XsrfTokenMismatchError</a>.</p>
									</dd>
								</dl>
							</div>
							<h4 class="tsd-parameters-title">Parameters</h4>
							<ul class="tsd-parameters">
								<li>
									<h5>sessionToken: <span class="tsd-signature-type">SessionToken</span></h5>
									<div class="tsd-comment tsd-typography">
										<p>the session token to try to remove.</p>
									</div>
								</li>
								<li>
									<h5>requestTime: <span class="tsd-signature-type">Date</span></h5>
									<div class="tsd-comment tsd-typography">
										<p>the time at which the request was issued to the identity service. Used
										populate various &quot;modified_at&quot; fields.</p>
									</div>
								</li>
								<li>
									<h5>xsrfToken: <span class="tsd-signature-type">string</span></h5>
									<div class="tsd-comment tsd-typography">
										<p>the xsrfToken which guards this mutation from being issues via XSRF
										attacks.</p>
									</div>
								</li>
							</ul>
							<h4 class="tsd-returns-title">Returns <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">void</span><span class="tsd-signature-symbol">&gt;</span></h4>
						</li>
					</ul>
				</section>
				<section class="tsd-panel tsd-member tsd-kind-method tsd-parent-kind-class tsd-is-static">
					<a name="_dbsessiontosession" class="tsd-anchor"></a>
					<h3><span class="tsd-flag ts-flagStatic">Static</span> _db<wbr>Session<wbr>ToSession</h3>
					<ul class="tsd-signatures tsd-kind-method tsd-parent-kind-class tsd-is-static">
						<li class="tsd-signature tsd-kind-icon">_db<wbr>Session<wbr>ToSession<span class="tsd-signature-symbol">(</span>dbSession<span class="tsd-signature-symbol">: </span><span class="tsd-signature-type">any</span>, dbUser<span class="tsd-signature-symbol">?: </span><span class="tsd-signature-type">any</span><span class="tsd-signature-symbol"> | </span><span class="tsd-signature-type">null</span>, auth0Profile<span class="tsd-signature-symbol">?: </span><a href="_auth0_profile_.auth0profile.html" class="tsd-signature-type">Auth0Profile</a><span class="tsd-signature-symbol"> | </span><span class="tsd-signature-type">null</span><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol">: </span><span class="tsd-signature-type">Session</span></li>
					</ul>
					<ul class="tsd-descriptions">
						<li class="tsd-description">
							<aside class="tsd-sources">
								<ul>
									<li>Defined in repository.ts:565</li>
								</ul>
							</aside>
							<h4 class="tsd-parameters-title">Parameters</h4>
							<ul class="tsd-parameters">
								<li>
									<h5>dbSession: <span class="tsd-signature-type">any</span></h5>
								</li>
								<li>
									<h5><span class="tsd-flag ts-flagDefault value">Default value</span> dbUser: <span class="tsd-signature-type">any</span><span class="tsd-signature-symbol"> | </span><span class="tsd-signature-type">null</span><span class="tsd-signature-symbol"> =&nbsp;null</span></h5>
								</li>
								<li>
									<h5><span class="tsd-flag ts-flagDefault value">Default value</span> auth0Profile: <a href="_auth0_profile_.auth0profile.html" class="tsd-signature-type">Auth0Profile</a><span class="tsd-signature-symbol"> | </span><span class="tsd-signature-type">null</span><span class="tsd-signature-symbol"> =&nbsp;null</span></h5>
								</li>
							</ul>
							<h4 class="tsd-returns-title">Returns <span class="tsd-signature-type">Session</span></h4>
						</li>
					</ul>
				</section>
			</section>
		</div>
		<div class="col-4 col-menu menu-sticky-wrap menu-highlight">
			<nav class="tsd-navigation primary">
				<ul>
					<li class="globals  ">
						<a href="../globals.html"><em>Globals</em></a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="../modules/_auth0_profile_.html">"auth0-<wbr>profile"</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="../modules/_config_.html">"config"</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="../modules/_identity_router_.html">"identity-<wbr>router"</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="../modules/_index_.html">"index"</a>
					</li>
					<li class="current tsd-kind-external-module">
						<a href="../modules/_repository_.html">"repository"</a>
					</li>
				</ul>
			</nav>
			<nav class="tsd-navigation secondary menu-sticky">
				<ul class="before-current">
				</ul>
				<ul class="current">
					<li class="current tsd-kind-class tsd-parent-kind-external-module">
						<a href="_repository_.repository.html" class="tsd-kind-icon">Repository</a>
						<ul>
							<li class=" tsd-kind-constructor tsd-parent-kind-class">
								<a href="_repository_.repository.html#constructor" class="tsd-kind-icon">constructor</a>
							</li>
							<li class=" tsd-kind-property tsd-parent-kind-class tsd-is-static">
								<a href="_repository_.repository.html#max_number_of_users_to_return" class="tsd-kind-icon">MAX_<wbr>NUMBER_<wbr>OF_<wbr>USERS_<wbr>TO_<wbr>RETURN</a>
							</li>
							<li class=" tsd-kind-method tsd-parent-kind-class">
								<a href="_repository_.repository.html#_dbusertopublicuser" class="tsd-kind-icon">_db<wbr>User<wbr>ToPublic<wbr>User</a>
							</li>
							<li class=" tsd-kind-method tsd-parent-kind-class">
								<a href="_repository_.repository.html#agreetocookiepolicyforsession" class="tsd-kind-icon">agree<wbr>ToCookie<wbr>Policy<wbr>For<wbr>Session</a>
							</li>
							<li class=" tsd-kind-method tsd-parent-kind-class">
								<a href="_repository_.repository.html#getorcreatesession" class="tsd-kind-icon">get<wbr>OrCreate<wbr>Session</a>
							</li>
							<li class=" tsd-kind-method tsd-parent-kind-class">
								<a href="_repository_.repository.html#getorcreateuseronsession" class="tsd-kind-icon">get<wbr>OrCreate<wbr>User<wbr>OnSession</a>
							</li>
							<li class=" tsd-kind-method tsd-parent-kind-class">
								<a href="_repository_.repository.html#getsession" class="tsd-kind-icon">get<wbr>Session</a>
							</li>
							<li class=" tsd-kind-method tsd-parent-kind-class">
								<a href="_repository_.repository.html#getuseronsession" class="tsd-kind-icon">get<wbr>User<wbr>OnSession</a>
							</li>
							<li class=" tsd-kind-method tsd-parent-kind-class">
								<a href="_repository_.repository.html#getusersinfo" class="tsd-kind-icon">get<wbr>Users<wbr>Info</a>
							</li>
							<li class=" tsd-kind-method tsd-parent-kind-class">
								<a href="_repository_.repository.html#init" class="tsd-kind-icon">init</a>
							</li>
							<li class=" tsd-kind-method tsd-parent-kind-class">
								<a href="_repository_.repository.html#removesession" class="tsd-kind-icon">remove<wbr>Session</a>
							</li>
							<li class=" tsd-kind-method tsd-parent-kind-class tsd-is-static">
								<a href="_repository_.repository.html#_dbsessiontosession" class="tsd-kind-icon">_db<wbr>Session<wbr>ToSession</a>
							</li>
						</ul>
					</li>
				</ul>
				<ul class="after-current">
					<li class=" tsd-kind-class tsd-parent-kind-external-module">
						<a href="_repository_.repositoryerror.html" class="tsd-kind-icon">Repository<wbr>Error</a>
					</li>
					<li class=" tsd-kind-class tsd-parent-kind-external-module">
						<a href="_repository_.sessionnotfounderror.html" class="tsd-kind-icon">Session<wbr>Not<wbr>Found<wbr>Error</a>
					</li>
					<li class=" tsd-kind-class tsd-parent-kind-external-module">
						<a href="_repository_.usernotfounderror.html" class="tsd-kind-icon">User<wbr>Not<wbr>Found<wbr>Error</a>
					</li>
					<li class=" tsd-kind-class tsd-parent-kind-external-module">
						<a href="_repository_.xsrftokenmismatcherror.html" class="tsd-kind-icon">Xsrf<wbr>Token<wbr>Mismatch<wbr>Error</a>
					</li>
				</ul>
			</nav>
		</div>
	</div>
</div>
<footer class="with-border-bottom">
	<div class="container">
		<h2>Legend</h2>
		<div class="tsd-legend-group">
			<ul class="tsd-legend">
				<li class="tsd-kind-module"><span class="tsd-kind-icon">Module</span></li>
				<li class="tsd-kind-object-literal"><span class="tsd-kind-icon">Object literal</span></li>
				<li class="tsd-kind-variable"><span class="tsd-kind-icon">Variable</span></li>
				<li class="tsd-kind-function"><span class="tsd-kind-icon">Function</span></li>
				<li class="tsd-kind-function tsd-has-type-parameter"><span class="tsd-kind-icon">Function with type parameter</span></li>
				<li class="tsd-kind-index-signature"><span class="tsd-kind-icon">Index signature</span></li>
				<li class="tsd-kind-type-alias"><span class="tsd-kind-icon">Type alias</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-enum"><span class="tsd-kind-icon">Enumeration</span></li>
				<li class="tsd-kind-enum-member"><span class="tsd-kind-icon">Enumeration member</span></li>
				<li class="tsd-kind-property tsd-parent-kind-enum"><span class="tsd-kind-icon">Property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-enum"><span class="tsd-kind-icon">Method</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-interface"><span class="tsd-kind-icon">Interface</span></li>
				<li class="tsd-kind-interface tsd-has-type-parameter"><span class="tsd-kind-icon">Interface with type parameter</span></li>
				<li class="tsd-kind-constructor tsd-parent-kind-interface"><span class="tsd-kind-icon">Constructor</span></li>
				<li class="tsd-kind-property tsd-parent-kind-interface"><span class="tsd-kind-icon">Property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-interface"><span class="tsd-kind-icon">Method</span></li>
				<li class="tsd-kind-index-signature tsd-parent-kind-interface"><span class="tsd-kind-icon">Index signature</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-class"><span class="tsd-kind-icon">Class</span></li>
				<li class="tsd-kind-class tsd-has-type-parameter"><span class="tsd-kind-icon">Class with type parameter</span></li>
				<li class="tsd-kind-constructor tsd-parent-kind-class"><span class="tsd-kind-icon">Constructor</span></li>
				<li class="tsd-kind-property tsd-parent-kind-class"><span class="tsd-kind-icon">Property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-class"><span class="tsd-kind-icon">Method</span></li>
				<li class="tsd-kind-accessor tsd-parent-kind-class"><span class="tsd-kind-icon">Accessor</span></li>
				<li class="tsd-kind-index-signature tsd-parent-kind-class"><span class="tsd-kind-icon">Index signature</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-constructor tsd-parent-kind-class tsd-is-inherited"><span class="tsd-kind-icon">Inherited constructor</span></li>
				<li class="tsd-kind-property tsd-parent-kind-class tsd-is-inherited"><span class="tsd-kind-icon">Inherited property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-class tsd-is-inherited"><span class="tsd-kind-icon">Inherited method</span></li>
				<li class="tsd-kind-accessor tsd-parent-kind-class tsd-is-inherited"><span class="tsd-kind-icon">Inherited accessor</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-property tsd-parent-kind-class tsd-is-protected"><span class="tsd-kind-icon">Protected property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-class tsd-is-protected"><span class="tsd-kind-icon">Protected method</span></li>
				<li class="tsd-kind-accessor tsd-parent-kind-class tsd-is-protected"><span class="tsd-kind-icon">Protected accessor</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-property tsd-parent-kind-class tsd-is-private"><span class="tsd-kind-icon">Private property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-class tsd-is-private"><span class="tsd-kind-icon">Private method</span></li>
				<li class="tsd-kind-accessor tsd-parent-kind-class tsd-is-private"><span class="tsd-kind-icon">Private accessor</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-property tsd-parent-kind-class tsd-is-static"><span class="tsd-kind-icon">Static property</span></li>
				<li class="tsd-kind-call-signature tsd-parent-kind-class tsd-is-static"><span class="tsd-kind-icon">Static method</span></li>
			</ul>
		</div>
	</div>
</footer>
<div class="container tsd-generator">
	<p>Generated using <a href="http://typedoc.org/" target="_blank">TypeDoc</a></p>
</div>
<div class="overlay"></div>
<script src="../assets/js/main.js"></script>
<script>if (location.protocol == 'file:') document.write('<script src="../assets/js/search.js"><' + '/script>');</script>
</body>
</html>